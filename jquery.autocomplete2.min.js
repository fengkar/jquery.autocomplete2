(function(c){String.prototype.splice=function(c,g,a){return this.slice(0,c)+a+this.slice(c+Math.abs(g))};c.autocomplete2=function(o,g){var a=this;a.settings={};var l=function(b){a.has_suggestions=!0;for(var h=[],d=b.length,b=b.toLowerCase(),c=a.possible_suggestions.length-1;0<=c;c--)a.settings.anywhere?0<=a.possible_suggestions[c].toLowerCase().indexOf(b)&&h.unshift(a.possible_suggestions[c]):a.possible_suggestions[c].toLowerCase().substr(0,d)==b&&h.unshift(a.possible_suggestions[c]);a.possible_suggestions=
h},m=function(b){for(var c=[],d=a.possible_suggestions.length-1;0<=d;d--)c.unshift(a.settings.anywhere?"<li>"+a.possible_suggestions[d].splice(a.possible_suggestions[d].indexOf(b),b.length,"<span>"+b+"</span>")+"</li>":"<li><span>"+b+"</span>"+a.possible_suggestions[d].substr(b.length)+"</li>");c.splice(a.settings.max_suggestions,c.length-a.settings.max_suggestions);a.$suggestion_list.html(c.toString().replace(/,/g,""));a.$suggestion_list_items=a.$suggestion_list.find("li");a.possible_suggestions.length?
(a.$suggestion_list.show(),i(b,a.possible_suggestions[0])):(e(),f())},j=function(){f();var b=a.$suggestion_list_items.eq(a.list_pos);a.$suggestion_list_items.removeClass("active");b.length?(b.addClass("active"),b=b.text(),a.$el.val(b)):(a.$el.val(a.typed_val),i(a.$el.val(),a.$suggestion_list_items.eq(0).text()))},k=function(){a.$suggestion_list_items&&a.$suggestion_list_items.removeClass("active")},n=function(){var b=a.$el.val();a.$el.val("");a.reset_possible_suggestions();e();f();a.$el.focus();if(a.settings.on_complete&&
"function"==typeof a.settings.on_complete)a.settings.on_complete(b)},e=function(){a.$suggestion_list.hide()},i=function(b,c){a.settings.anywhere||a.$helper.html("<span>"+b+"</span>"+c.substr(b.length))},f=function(){a.$helper.html("")};a.reset_possible_suggestions=function(){a.possible_suggestions=a.settings.suggestions;a.has_suggestions=!1;k();a.list_pos=-1};a.settings=c.extend({},{anywhere:!1,suggestions:null,max_suggestions:4,on_focus:function(){},on_blur:function(){},on_complete:function(){}},
g);a.$el=o;a.has_suggestions=!1;a.possible_suggestions=a.settings.suggestions;a.typed_val=a.$el.val();a.list_pos=-1;a.$el.wrap('<div class="autocomplete2-wrapper" />').after('<ul class="suggestions"></ul>').before('<div class="helper" />');a.$suggestion_list=a.$el.siblings(".suggestions");a.$helper=a.$el.siblings(".helper");(function(){var b=!1;a.$el.keydown(function(b){var d=c(this).val();switch(b.keyCode){case 38:b.preventDefault();a.list_pos--;if(0<=a.list_pos)j();else if(a.has_suggestions)-2==
a.list_pos?(a.list_pos=a.$suggestion_list_items.length-1,j()):(a.$el.val(a.typed_val),k(),i(a.$el.val(),a.$suggestion_list_items.eq(0).text()));break;case 39:if(d.length&&0==a.$suggestion_list.find(".active").length)a.$el.val(a.possible_suggestions[0]),k(),a.list_pos=-1,a.typed_val=a.$el.val();break;case 40:if(b.preventDefault(),a.has_suggestions){a.list_pos++;if(!(a.list_pos<=a.$suggestion_list_items.length))a.list_pos=0;j()}}}).keyup(function(b){var d=c(this).val();switch(b.keyCode){case 8:a.reset_possible_suggestions();
l(d);m(d);0==d.length&&(e(),f());break;case 13:d.length&&n();break;case 27:a.reset_possible_suggestions();e();f();break;case 37:break;case 38:break;case 39:break;case 40:break;default:a.typed_val=d,d.length&&(a.possible_suggestions.length?(l(d),m(d)):e())}}).focus(function(){if(!b){if(a.settings.on_focus&&"function"==typeof a.settings.on_focus)a.settings.on_focus();b=!0}}).blur(function(){b=!1;if(a.settings.on_blur&&"function"==typeof a.settings.on_blur)a.settings.on_blur()});a.$suggestion_list.on("click",
"li",function(){a.$el.val(c(this).text());n()}).on("hover","li",function(){a.list_pos=c(this).index();c(this).addClass("active").siblings().removeClass("active")})})()}})(jQuery);
